<script>
    // Standard function to add bubbles to the chat window
    function addMessageToUI(text, className, isHTML = false) {
        const chatBox = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = `message ${className}`;
        
        if (isHTML) {
            div.innerHTML = text; // Allows the bolding/icons from the backend
        } else {
            div.textContent = text;
        }
        
        chatBox.appendChild(div);
        
        // Auto-scroll to the bottom
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function sendMessage() {
        const inputField = document.getElementById('user-input');
        const text = inputField.value.trim();

        if (!text) return;

        // 1. Show user message in UI immediately
        addMessageToUI(text, 'user-msg');
        inputField.value = ''; // Clear the input box

        // 2. Send the JSON data to your Flask /chat route
        try {
            const response = await fetch('/chat', {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json' 
                },
                body: JSON.stringify({ message: text })
            });

            if (!response.ok) throw new Error('Server issues');

            const data = await response.json();

            // 3. Show the Bot's response (supports HTML for symbols/icons)
            addMessageToUI(data.response, 'bot-msg', true);

        } catch (error) {
            console.error("Fetch Error:", error);
            addMessageToUI("⚠️ Connection error. Please try again.", 'bot-msg');
        }
    }

    // Allows users to press 'Enter' instead of clicking 'Send'
    function handleEnter(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    }
</script>
